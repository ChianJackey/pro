{include file="Common/header"}
<body>
    <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
        <legend id="student_info"><b>基本信息</b></legend>
    </fieldset>
    <form class="layui-form" action="">
        <div class="layui-inline">
            <label class="layui-form-label">年月范围</label>
            <div class="layui-input-inline">
                <input type="text" class="layui-input" id="test3" name="date" placeholder="  ">
            </div>
            <div class="layui-input-inline">
                <button type="button" class="layui-btn layui-btn-normal layui-btn-radius" lay-submit="" lay-filter="search">搜索</button>
            </div>
        </div>
    </form>
    <div class="layui-tab" lay-filter="test1">
        <ul class="layui-tab-title">
            <li data-type="1" class="layui-this">收益统计</li>
            <li data-type="2">成交金额统计</li>
          </ul>
    </div>
    <table lay-filter="parse-table-demo" class="layui-hide" lay-data="{id: 'idTest'}" id="data"></table>
    <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
        <legend id="student_info"><b>博主广告排行榜</b></legend>
    </fieldset>
    <table lay-filter="parse-table-demo" class="layui-hide" lay-data="{id: 'idTest'}" id="data2"></table>
</body>
<script>
    var table;
    var tableIns1;
    var tableIns2;
    var form;
    var layer;
    var element;
    var laydate;
    layui.use(['table','layer','form', 'element', 'laydate'], function(){
        $ = layui.jquery;
        table = layui.table;
        form = layui.form;
        layer = layui.layer;
        element = layui.element;
        laydate = layui.laydate;
        tableIns1 = table.render({
            elem: '#data',
            url: 'admin-today-statistics',
            page: false,
            method: 'get',
            headers: {authorization: '{$token}'},
            cols: [[
                {field:'v0', align:'center', title:'', unresize: true},
                {foreach $platform as $k => $v}
                {field:'v{$k}', align:'center', title:'{$v}', unresize: true},
                {/foreach}
                {field:'v4', align:'center', title:'总计', unresize: true}
            ]]
        });
        tableIns2 = table.render({
            elem: '#data2',
            url: 'admin-blogger-ranking',
            page: true,
            method: 'get',
            headers: {authorization: '{$token}'},
            limit: 15,
            limits: [15],
            cols: [[
                {field:'name', align:'center', title:'', unresize: true},
                {foreach $platform as $k => $v}
                {field:'title_{$k}', align:'center', title:'{$v}', unresize: true},
                {/foreach}
                {field:'money', align:'center', title:'总计', unresize: true},
            ]]
        })

        element.on('tab(test1)', function(){
            location.hash = 'test1='+ this.getAttribute('lay-id');
            tableIns1.reload({where:{type:this.getAttribute('data-type')}});
        });
        //年月范围
        laydate.render({
            elem: '#test3',
            type: 'month'
        });
        form.on('submit(search)',function(data){
            formData = data.field;
            tableIns1.reload({where:{date:formData.date},page: {curr: 1}});
            tableIns2.reload({where:{date:formData.date},page: {curr: 1}});
            layer.closeAll();
        	return false;
        })
    });
</script>